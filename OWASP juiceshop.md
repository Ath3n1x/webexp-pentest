# OWASP JUICE SHOP

## Setting up


 1. Install Docker on your computer.

 2. On the command line run `sudo docker pull bkimminich/juice-shop` to download the latest image described above.

 3. Run `sudo docker run -d -p 127.0.0.1:3000:3000 bkimminich/juice-shop` to launch the container with that image.

 4. Browse to http://localhost:3000 in Burpsuite browser.


## Solutions
## MISC
### 1. Scoreboard 

![image](https://github.com/user-attachments/assets/635d9106-5963-48d7-b8cd-78ed7c6fef5e)


> So we need to find the scorebaord? 
 
**Inspect**:
Under Sources, numerous js files can be seen. Check out the main.js file. `ctrl+f` : to search keyword 'Score Board'. Read through.
        
![image](https://hackmd.io/_uploads/SykQ0p0j0.png)

Keep going!

![image](https://hackmd.io/_uploads/HJXAApRjR.png)

Here you can see the resolved and that is the add-on to the url that you need to give.

`http://localhost:3000/#/score-board`

![image](https://hackmd.io/_uploads/r1iQyAAjA.png)
Success!!!

### 2. Bully Chatbot

> hints: 
> This challenge is about nagging the support chatbot to hand out a coupon code that can subsequently be used to get a discount during the checkout process.
> The bot is reluctant to give you a coupon as it’s coming up with various excuses for not giving you one
> Asking over and over again like a little kid might actually help you succeed in this case

While I was exploring. I had created an account with a non-existent email and password. Logging in is needed to access the chatbot.
And while adding stuff to the basket and doing the process of checkout. There was a section to enter the coupon during checkout. (Obsolete)

From the side menu on the left, click on the support chat. Basically spam with coupon requests. Here we go.

![image](https://hackmd.io/_uploads/rkUoWARiR.png)

> k#*Agg+yBo

![image](https://hackmd.io/_uploads/ryp0WCAiR.png)

Another success!!!

### 3. Access a confidential document

> Somewhere in the application you can find a file that contains sensitive information about some - potentially hostile - takeovers the Juice Shop top management has planned.
Analyze and tamper with links in the application that deliver a file directly.
The file you are looking for is not protected in any way. Once you found it you can also access it.

--> Trying to solve this using burpsuite. Is there a way to list file using brupsuite? Send request to intruder can help? 

--> Searching for tools to crawl and list the documents in a websites.
[dirb, dirbuster, gobuster]

Lets use dirb.

> While I was using dirb I accidently got a solve: ![image](https://hackmd.io/_uploads/SJBua0AoC.png)
lol! Lets come back to this later. 

![image](https://hackmd.io/_uploads/HJknaRRiR.png)

Lets check these files out. Inside ftp, there was an acquisitions file. It seemed to match the description. On going back to the shop we have the success notification.

![image](https://hackmd.io/_uploads/SJ2s0ARoC.png)
Success!!!

4. Privacy Policy

--> Go to account, select privacy policy and the challenge is solved.

# OWASP top 10 

## A1. Broken Access Control
Authentication and access controls not properly implemented. Unauthorized user can access sensitive data. Eg: A customer can view documents meant for the admin.

### 1. View Basket (Horizontal privilage escalation)
> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/broken-access-control.html#_view_another_users_shopping_basket)

![image](https://hackmd.io/_uploads/Hyd2DLS3A.png)

1. Add products into the basket.
2. Inspect the page. Under application you can see session storage.
> Session key: an encryption and decryption key that is randomly generated to ensure the security of a communications session between a user and another computer or between two computers
3.  ![image](https://hackmd.io/_uploads/ryj3KUBhC.png)
4. Change the value of bid and refresh. 
5. YOu have successfully peaked into the basket of another user from your account. 
![image](https://hackmd.io/_uploads/rysK9Ir3A.png)

### 2. Forged Feedback

1. Open customer feedback page. Send a normal feedback and analyze that with burpsuite to understand the fields.
2. ![image](https://hackmd.io/_uploads/HJYKtdS2R.png)
this user_id field can be seen as one of the fields.
3. Try manipulating that and send the request. The feedback was accepted when I changed it to 2. 
4. ![image](https://hackmd.io/_uploads/SkbrynUn0.png)
Challenge Solved.

### 3. Password Strength
> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/broken-authentication.html#_log_in_with_the_administrators_user_credentials_without_previously_changing_them_or_applying_sql_injection)

1. Logout and login with the admin creds.

2. Found the admin email from the product review of the first juice. Gave that and started guessing just for fun: `admin123` was the first guess and it worked. *sigh*

3. ![image](https://hackmd.io/_uploads/HJV5_2LnR.png)

Since it was a unsatisfying solve,lets try another appraoch.

1. Intercept the login with Burpsuite.
2. Fill the admin email.
3. 

### 4. Five-star Feedback

> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/broken-access-control.html#_get_rid_of_all_5_star_customer_feedback)



## A2. Crytographic Failure

### 1. Weird Crypto

> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/cryptographic-issues.html#_inform_the_shop_about_an_algorithm_or_library_it_should_definitely_not_use_the_way_it_does)

Searched for weak cryptographic algorithms. Got MD5,DES as some answers. Gave MD5 in the comment section and the challenge was solved.

![image](https://hackmd.io/_uploads/HkHtT-J2R.png)
Submit and Success!!!
![Uploading file..._voseuuxlx]()

2. Exposed Metrics
 > Popular monitoring system mentioned is [prometheus](https://github.com/prometheus/prometheus) 
 
 > [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/sensitive-data-exposure.html#_find_the_endpoint_that_serves_usage_data_to_be_scraped_by_a_popular_monitoring_system) 

> [Prometheus man](https://prometheus.io/docs/introduction/first_steps/)

**You can also verify that Prometheus is serving metrics about itself by navigating to its own metrics endpoint: http://localhost:9090/metrics.**
http://localhost:3000/metrics in our case. 

![image](https://hackmd.io/_uploads/HJpJJDSnA.png)
Challenge Solved!


## A3. Injection
Inject malicious code through an application to another system. 
Attacks:
1. SQL injection: inject malicious SQL queries to manipulate the db.
2. Command injection: inject arbitary commands into system shell or os command interpreter to make system execute unintendedly.
3. NoSQL injection: Similar to SQLi but targets NoSQL dbs like MongoDB.
4. Lightweight Directory Access Protocol(LDAP): inject malicious LDAP queries to manipulate directory service operations.
5. XML injection: inject malicious XML content into an application that processes XML data for info disclosure, denial of service or data manipulation.
(Some others include: XPath injection, Code Injection, CRLF(Carriage return and Line Feed), Host header injection, Email Header Injection).

[Reference](https://pwning.owasp-juice.shop/companion-guide/latest/part2/injection.html)

Any time an application uses an interpreter of any kind then there is a risk of introducing an injection vulnerability.

When a web application passes information from an HTTP request through as part of an external request, it must be carefully scrubbed.

### 1. Login Admin (SQL injection)
Login with administrator's user account. 

> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/injection.html#_log_in_with_the_administrators_user_account)

To solve we would have to manipulate the login page as we need to login as admin.
1. Try `'` in the name field to see how it reacts. 
Error: ![image](https://hackmd.io/_uploads/HyqwUl120.png)
2. The first account in a database is often an administrative user, we can exploit this behavior to log in as the first user in the database. 
3. Here we use `' or 1=1 --` to manipulate the name field and access the first account and login.
> This causes the application to perform the query:
**SELECT * FROM users WHERE username = '' OR 1=1-- ' AND password = 'foo'**

>Because the comment sequence (- -) causes the remainder of the query to be ignored, this is equivalent to:
**SELECT * FROM users WHERE username = ' ' OR 1=1**

5. Yep, its a success!
![image](https://hackmd.io/_uploads/HyVePeynC.png)

Mitigation recom: If the access of the application is restricted or if a filter is introduced to check the db queries.

### 2. DOM XSS(Document Object Model-based Cross-site Scripting)
>[hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/xss.html#_perform_a_dom_xss_attack)

1. `<script>alert(xss)</script>` we can see that the script tag is embedded in the js console but nothing much happens. But we now know that the site is vuln to xss.
2. Try another payload: `<iframe src="javascript:alert(`xss`)">`
![image](https://hackmd.io/_uploads/B1S5mGJn0.png)
![image](https://hackmd.io/_uploads/HyiomMJ20.png)
3. Success!!!
![image](https://hackmd.io/_uploads/r1jVVGknR.png)

This was a DOM XSS attack, because your payload was handled and improperly embedded into the page by the application frontend code without even sending it to the server.

### 3. Bonus Payload(SQL injection)
>[hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/xss.html#_use_the_bonus_payload_in_the_dom_xss_challenge)

1. Copy and paste the payload given in the desciption to the same search field in the dom xss challenge. 

`<iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/771984076&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe> `

2. Submit and Success!!!
![image](https://hackmd.io/_uploads/SJVhBMynC.png)

### ++4. Zero Stars++

Category: Improper Input Validation.
[OWASP input validation cheatsheet](https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html)

> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/improper-input-validation.html#_give_a_devastating_zero_star_feedback_to_the_store)

*The customer feedback rating is from 1 star to 5 stars. Need to give a 0 star rating.*

1. Open the feedback form and inspect.
2. Open the elements tab and search for Submit. You can see the code for the Submit button: ![image](https://hackmd.io/_uploads/H125XwB3C.png)

3. Remove the disabled = 'True' attribute under edit as html and submit the form. Since there is no rating provided, it will be accessed as null.
4. ![image](https://hackmd.io/_uploads/rJ54rPBnA.png)
Challenge Solved!!

Mitigation: 
1. Enhance client-side scripts to prevent easy tampering from the developer console. 
2. Ensure that the datatype for rating doesnt accept `null` or any other datatypes as default.

++5. Repetitive Registration++

Category: Improper input Validation

> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/improper-input-validation.html#_follow_the_dry_principle_while_registering_a_user)

--> User registration has a repeat password section. DRY (DO NOT REPEAT YOURSELF) principle makes sure that: **every piece of knowledge must have a single, unambiguous, authoritative representation within a system.**

1. Logout and register as customer. Fill all the sections and give the repeat password wrong on purpose.
2. Inpsect the tab. I was searching along the repeat password tab but since the Register button is the one disabled, you need to manually change there.
![image](https://hackmd.io/_uploads/Sk23_vB30.png)
3. **disabled="true"** manually change this through edit as html and click register button. 
4. ![image](https://hackmd.io/_uploads/Sy4YtvrhC.png)
Challenge Solved!!

Mitigation: 
1. Ensure that all input validations performed on the client side are also enforced on the server side. This includes matching password fields, input length restrictions, format requirements, and more.
2. Forms should be designed to reject submissions where critical fields have been tampered with or do not meet the application’s requirements.

### ++6. Missing Encoding++
Category: improper input validation
> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/improper-input-validation.html#_retrieve_the_photo_of_bjoerns_cat_in_melee_combat_mode)

1. Access photo Wall and notice that the first image seems to be broken.
2. On searching thru the source with the kayword `zatschi` for the tag, you notice the src has the image url. There seems to be an encoding problem with this url so use an online url encoder to encode the url properly.
3. The url that I got is: `assets%2Fpublic%2Fimages%2Fuploads%2F%F0%9F%98%BC-%23zatschi-%23whoneedsfourlegs-1572600969477.jpg` 
4. Manually edit as html and add that to the encoded url to the src. 
5. ![image](https://hackmd.io/_uploads/rJRAHOrhA.png)
> The photo shows up now but the challenge is not marked as solved.

**Try 2**
1. Switch to firefox and open the localhost:3000.
2. Inspect element and open the networks tab (refresh page for all files to show up). 
3. ![image](https://hackmd.io/_uploads/rJYxQnL3C.png)
You can see the cat emoji as filename. 
4. ![image](https://hackmd.io/_uploads/BkQVm3LhA.png)
Click on edit and resend and the page on the left shows up. We can try to replace the get request with the encoded url `http://localhost:3000/assets/public/images/uploads/%F0%9F%98%BC-%23zatschi-%23whoneedsfourlegs-1572600969477.jpg` (It seems that the hashes are the problem and those are the ones that needed encoding).
> Instead of using an online encoder, just replacing the # with `%23` solved the challenge. 
5. ![image](https://hackmd.io/_uploads/SJzAB3U2R.png)
Challenge solved!


### . Login Jim (SQL injection)
> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/injection.html#_log_in_with_jims_user_account)



## A4. Insecure design

## A5. Security Misconfiguration
++1. Outdated Allowlists++
Category: Unvalidated redirects
> [hint](https://pwning.owasp-juice.shop/companion-guide/latest/part2/improper-input-validation.html#_follow_the_dry_principle_while_registering_a_user)

1. Searched the bitcoin and eth keywords in the console. No reuslt! While checking out the main.js, bitcoin keyword gave search results.
2. ![image](https://hackmd.io/_uploads/ryreCDH2A.png)
There seems have been a qrcode to accept the bitcoin and from the results, we can see the redirect url. 
3. Need to redirect to another link in the outdated allowlist. 
4. `/redirect?to=https://blockchain.info/address/1AbKfgvw9psQ41NbLi8kufDQTezwG8DRZm` copy this section and add it to the original `localhost:3000` url. And you are successfully redirected.
5. ![image](https://hackmd.io/_uploads/BkgEZ_B2C.png)
Challenge Solved

### 2. Error handling

![image](https://hackmd.io/_uploads/S1Jxly12A.png)

These are the issues that I found in the js console that might have triggered the success message for this challenge. (check up abt this)

To trigger:
Keep intercept on and click on any product in the home page. The request will be captured by burpsuite and you can modify this request to trigger and error.

From: ![image](https://hackmd.io/_uploads/ryx_RXky2R.png)

to: ![image](https://hackmd.io/_uploads/rkNxV11hC.png)

![image](https://hackmd.io/_uploads/ry31Syyn0.png)
After enabling this, forward the request. Success!! Challenge solved.
![image](https://hackmd.io/_uploads/SJBua0AoC.png)

![image](https://hackmd.io/_uploads/HkFHBkyn0.png)
The error message is shown here (improper error handling) and by following this path the attackers can find out file locations. Again edit the request and the files can be seen by causing internal server error.

![image](https://hackmd.io/_uploads/SycoIyk2A.png)
You can see some file locations here. 

![image](https://hackmd.io/_uploads/H1qeDyJhR.png)

The error 500 internal server error in js console.

Mitigate recom: Error messages or debugging info should not reveal sensitive information. 
## A6. Vulnerable and Outdated Components

## A7. Identification and authentication failures

## A8. Software and Data integrity failures

## A9. Security Logging and Monitoring Failures

## A10. Server Side Request Forgery
